<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resultados - BioCalc</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container mt-4">
        <header class="mb-4">
            <h2>üìä Resultados do C√°lculo</h2>
            <a href="/" class="btn btn-outline-primary btn-sm">‚Üê Novo C√°lculo</a>
        </header>

        <div class="row">
            <!-- Card de Resultados -->
            <div class="col-md-6">
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5>Resultados Principais</h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-success">
                            <h4>Intensidade de Carbono</h4>
                            <h1 class="display-4">
                                {{ resultados.intensidade_carbono }} 
                                <small class="fs-6">{{ resultados.unidades.intensidade }}</small>
                            </h1>
                            <hr>
                            <h4>CBIOs Estimados</h4>
                            <h1 class="display-4">
                                {{ resultados.cbios }} 
                                <small class="fs-6">{{ resultados.unidades.cbios }}</small>
                            </h1>
                        </div>
                        
                        {% if resultados.dados_entrada.metodo_acv in ['CFF', 'Zero-Burden'] %}
                        <div class="alert alert-warning">
                            ‚ö†Ô∏è <strong>Aten√ß√£o:</strong> 
                            O m√©todo {{ resultados.dados_entrada.metodo_acv }} n√£o √© reconhecido pelo RenovaBio 
                            para certifica√ß√£o oficial de CBIOs. Este resultado √© apenas para fins de pesquisa.
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Gr√°fico -->
            <div class="col-md-6">
                <div class="card mb-4">
                    <div class="card-header bg-info text-white">
                        <h5>Visualiza√ß√£o</h5>
                    </div>
                    <div class="card-body">
                        <canvas id="graficoResultados" width="400" height="300"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dados de Entrada -->
        <div class="card mb-4">
            <div class="card-header">
                <h5>Dados de Entrada</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <table class="table table-sm">
                            <tr>
                                <th>Biomassa:</th>
                                <td>{{ resultados.dados_entrada.biomassa }}</td>
                            </tr>
                            <tr>
                                <th>Quantidade:</th>
                                <td>{{ resultados.dados_entrada.quantidade }} ton/ano</td>
                            </tr>
                            <tr>
                                <th>Modal Transporte:</th>
                                <td>{{ resultados.dados_entrada.transporte_modal }}</td>
                            </tr>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <table class="table table-sm">
                            <tr>
                                <th>Dist√¢ncia:</th>
                                <td>{{ resultados.dados_entrada.transporte_distancia }} km</td>
                            </tr>
                            <tr>
                                <th>Energia El√©trica:</th>
                                <td>{{ resultados.dados_entrada.energia_eletrica }} MWh/ano</td>
                            </tr>
                            <tr>
                                <th>M√©todo ACV:</th>
                                <td>{{ resultados.dados_entrada.metodo_acv }}</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- A√ß√µes -->
        <div class="card">
            <div class="card-body">
                <div class="d-grid gap-2 d-md-flex justify-content-md-center">
                    <a href="/" class="btn btn-primary me-2">üîÑ Novo C√°lculo</a>
                    <button onclick="exportarPDF()" class="btn btn-success me-2">üìÑ Exportar PDF</button>
                    <a href="/historico" class="btn btn-secondary">üìã Hist√≥rico</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configura√ß√£o do gr√°fico
        const ctx = document.getElementById('graficoResultados').getContext('2d');
        const intensidade = {{ resultados.intensidade_carbono }};
        const referencia = 83.8; // Refer√™ncia f√≥ssil
        
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['BioCombust√≠vel', 'Refer√™ncia F√≥ssil'],
                datasets: [{
                    label: 'Intensidade de Carbono (gCO‚ÇÇeq/MJ)',
                    data: [intensidade, referencia],
                    backgroundColor: [
                        intensidade < referencia ? 'rgba(75, 192, 192, 0.8)' : 'rgba(255, 99, 132, 0.8)',
                        'rgba(201, 203, 207, 0.8)'
                    ],
                    borderColor: [
                        intensidade < referencia ? 'rgb(75, 192, 192)' : 'rgb(255, 99, 132)',
                        'rgb(201, 203, 207)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'gCO‚ÇÇeq/MJ'
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `${context.dataset.label}: ${context.parsed.y.toFixed(2)}`;
                            }
                        }
                    }
                }
            }
        });

        // Fun√ß√£o para exportar PDF (simulada)
        function exportarPDF() {
            alert('Funcionalidade de exporta√ß√£o PDF ser√° implementada na pr√≥xima vers√£o!');
            // Implementa√ß√£o futura com jsPDF
        }
    </script>
</body>
</html>